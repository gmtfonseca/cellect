"use strict";

var _this = void 0;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var KEY_STATE = {
  Up: 0,
  Down: 1
};

var Key = /*#__PURE__*/function () {
  function Key(code) {
    _classCallCheck(this, Key);

    this.code = code;
    this.state = KEY_STATE.Up;
  }

  _createClass(Key, [{
    key: "isDown",
    value: function isDown() {
      return this.state === KEY_STATE.Down;
    }
  }]);

  return Key;
}();

var plusKey = new Key(107);
var minusKey = new Key(109);
var hoveredCell, totalElement;
injectTotalHtml();

function injectTotalHtml() {
  fetch(chrome.runtime.getURL('/total.html')).then(function (res) {
    return res.text();
  }).then(function (html) {
    document.body.insertAdjacentHTML('beforeend', html);
    totalElement = document.getElementById('total');
  });
}

window.onkeydown = function (e) {
  updateKeyState(e.keyCode, KEY_STATE.Down);
  updateCursor();
};

window.onkeyup = function (e) {
  updateKeyState(e.keyCode, KEY_STATE.Up);
  updateCursor();
};

window.onmouseover = function (e) {
  hoveredCell = e.target;
  updateCursor();
};

function updateKeyState(code, state) {
  switch (code) {
    case plusKey.code:
      plusKey.state = state;
      break;

    case minusKey.code:
      minusKey.state = state;
      break;
  }
}

function updateCursor() {
  if (hoveredCell) {
    if (hoveredCell.tagName === 'TD' && (plusKey.isDown() || minusKey.isDown())) {
      hoveredCell.style.cursor = 'pointer';
    } else {
      hoveredCell.style.cursor = 'default';
    }
  }
}

var selectedCells = new Map();
var cells = document.querySelectorAll('td');
cells.forEach(function (cell) {
  return cell.addEventListener('click', handleCellClick.bind(_this, cell), false);
});

function handleCellClick(cell) {
  if (plusKey.isDown() || minusKey.isDown()) {
    var row = cell.closest('tr').rowIndex - 1;
    var col = cell.cellIndex;
    var cellIdx = "".concat(row, ":").concat(col);
    var value = parseNumber(cell.innerText);

    if (!Number.isNaN(value)) {
      if (selectedCells.has(cellIdx)) {
        if (plusKey.isDown()) {
          cell.classList.remove('plus-bg');
        } else {
          cell.classList.remove('minus-bg');
        }

        selectedCells["delete"](cellIdx);
      } else {
        var signedValue;

        if (plusKey.isDown()) {
          signedValue = value;
          cell.classList.remove('minus-bg');
          cell.classList.add('plus-bg');
        } else {
          signedValue = -value;
          cell.classList.remove('plus-bg');
          cell.classList.add('minus-bg');
        }

        selectedCells.set(cellIdx, signedValue);
      }

      var total = Array.from(selectedCells.values()).reduce(function (prev, curr) {
        return prev + curr * 100;
      }, 0) / 100;

      if (total === 0) {
        totalElement.style.display = 'none';
      } else {
        totalElement.style.display = 'block';
      }

      var totalFormatted = new Intl.NumberFormat('pt-BR').format(total);
      totalElement.innerText = totalFormatted;
    }
  } else {
    totalElement.innerText = '';
    totalElement.style.display = 'none';
  }
}

function parseNumber(str) {
  var brazilianStrNum = str.trim().replace(',', '@').replace('.', '').replace('@', '.');
  return Number(brazilianStrNum);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zZWxlY3QuanMiXSwibmFtZXMiOlsiS0VZX1NUQVRFIiwiVXAiLCJEb3duIiwiS2V5IiwiY29kZSIsInN0YXRlIiwicGx1c0tleSIsIm1pbnVzS2V5IiwiaG92ZXJlZENlbGwiLCJ0b3RhbEVsZW1lbnQiLCJpbmplY3RUb3RhbEh0bWwiLCJmZXRjaCIsImNocm9tZSIsInJ1bnRpbWUiLCJnZXRVUkwiLCJ0aGVuIiwicmVzIiwidGV4dCIsImh0bWwiLCJkb2N1bWVudCIsImJvZHkiLCJpbnNlcnRBZGphY2VudEhUTUwiLCJnZXRFbGVtZW50QnlJZCIsIndpbmRvdyIsIm9ua2V5ZG93biIsImUiLCJ1cGRhdGVLZXlTdGF0ZSIsImtleUNvZGUiLCJ1cGRhdGVDdXJzb3IiLCJvbmtleXVwIiwib25tb3VzZW92ZXIiLCJ0YXJnZXQiLCJ0YWdOYW1lIiwiaXNEb3duIiwic3R5bGUiLCJjdXJzb3IiLCJzZWxlY3RlZENlbGxzIiwiTWFwIiwiY2VsbHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlQ2VsbENsaWNrIiwiYmluZCIsInJvdyIsImNsb3Nlc3QiLCJyb3dJbmRleCIsImNvbCIsImNlbGxJbmRleCIsImNlbGxJZHgiLCJ2YWx1ZSIsInBhcnNlTnVtYmVyIiwiaW5uZXJUZXh0IiwiTnVtYmVyIiwiaXNOYU4iLCJoYXMiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJzaWduZWRWYWx1ZSIsImFkZCIsInNldCIsInRvdGFsIiwiQXJyYXkiLCJmcm9tIiwidmFsdWVzIiwicmVkdWNlIiwicHJldiIsImN1cnIiLCJkaXNwbGF5IiwidG90YWxGb3JtYXR0ZWQiLCJJbnRsIiwiTnVtYmVyRm9ybWF0IiwiZm9ybWF0Iiwic3RyIiwiYnJhemlsaWFuU3RyTnVtIiwidHJpbSIsInJlcGxhY2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxJQUFNQSxTQUFTLEdBQUc7QUFDaEJDLEVBQUFB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QURxQixHQUVyQkMsT0FGcUIsQ0FFYixHQUZhLEVBRVIsR0FGUSxFQUdyQkEsT0FIcUIsQ0FHYixHQUhhLEVBR1IsRUFIUSxFQUlyQkEsT0FKcUIsQ0FJYixHQUphLEVBSVIsR0FKUSxDQUF4QjtBQU1BLFNBQU92QixNQUFNLENBQUNxQixlQUFELENBQWI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEtFWV9TVEFURSA9IHtcclxuICBVcDogMCxcclxuICBEb3duOiAxLFxyXG59XHJcblxyXG5jbGFzcyBLZXkge1xyXG4gIGNvbnN0cnVjdG9yKGNvZGUpIHtcclxuICAgIHRoaXMuY29kZSA9IGNvZGVcclxuICAgIHRoaXMuc3RhdGUgPSBLRVlfU1RBVEUuVXBcclxuICB9XHJcblxyXG4gIGlzRG93bigpIHtcclxuICAgIHJldHVybiB0aGlzLnN0YXRlID09PSBLRVlfU1RBVEUuRG93blxyXG4gIH1cclxufVxyXG5cclxuY29uc3QgcGx1c0tleSA9IG5ldyBLZXkoMTA3KVxyXG5jb25zdCBtaW51c0tleSA9IG5ldyBLZXkoMTA5KVxyXG5cclxubGV0IGhvdmVyZWRDZWxsLCB0b3RhbEVsZW1lbnRcclxuXHJcbmluamVjdFRvdGFsSHRtbCgpXHJcblxyXG5mdW5jdGlvbiBpbmplY3RUb3RhbEh0bWwoKSB7XHJcbiAgZmV0Y2goY2hyb21lLnJ1bnRpbWUuZ2V0VVJMKCcvdG90YWwuaHRtbCcpKVxyXG4gICAgLnRoZW4oKHJlcykgPT4gcmVzLnRleHQoKSlcclxuICAgIC50aGVuKChodG1sKSA9PiB7XHJcbiAgICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBodG1sKVxyXG4gICAgICB0b3RhbEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG90YWwnKVxyXG4gICAgfSlcclxufVxyXG5cclxud2luZG93Lm9ua2V5ZG93biA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgdXBkYXRlS2V5U3RhdGUoZS5rZXlDb2RlLCBLRVlfU1RBVEUuRG93bilcclxuICB1cGRhdGVDdXJzb3IoKVxyXG59XHJcblxyXG53aW5kb3cub25rZXl1cCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgdXBkYXRlS2V5U3RhdGUoZS5rZXlDb2RlLCBLRVlfU1RBVEUuVXApXHJcbiAgdXBkYXRlQ3Vyc29yKClcclxufVxyXG5cclxud2luZG93Lm9ubW91c2VvdmVyID0gZnVuY3Rpb24gKGUpIHtcclxuICBob3ZlcmVkQ2VsbCA9IGUudGFyZ2V0XHJcbiAgdXBkYXRlQ3Vyc29yKClcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlS2V5U3RhdGUoY29kZSwgc3RhdGUpIHtcclxuICBzd2l0Y2ggKGNvZGUpIHtcclxuICAgIGNhc2UgcGx1c0tleS5jb2RlOlxyXG4gICAgICBwbHVzS2V5LnN0YXRlID0gc3RhdGVcclxuICAgICAgYnJlYWtcclxuICAgIGNhc2UgbWludXNLZXkuY29kZTpcclxuICAgICAgbWludXNLZXkuc3RhdGUgPSBzdGF0ZVxyXG4gICAgICBicmVha1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlQ3Vyc29yKCkge1xyXG4gIGlmIChob3ZlcmVkQ2VsbCkge1xyXG4gICAgaWYgKFxyXG4gICAgICBob3ZlcmVkQ2VsbC50YWdOYW1lID09PSAnVEQnICYmXHJcbiAgICAgIChwbHVzS2V5LmlzRG93bigpIHx8IG1pbnVzS2V5LmlzRG93bigpKVxyXG4gICAgKSB7XHJcbiAgICAgIGhvdmVyZWRDZWxsLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJ1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaG92ZXJlZENlbGwuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5jb25zdCBzZWxlY3RlZENlbGxzID0gbmV3IE1hcCgpXHJcbmNvbnN0IGNlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgndGQnKVxyXG5jZWxscy5mb3JFYWNoKChjZWxsKSA9PlxyXG4gIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDZWxsQ2xpY2suYmluZCh0aGlzLCBjZWxsKSwgZmFsc2UpXHJcbilcclxuXHJcbmZ1bmN0aW9uIGhhbmRsZUNlbGxDbGljayhjZWxsKSB7XHJcbiAgaWYgKHBsdXNLZXkuaXNEb3duKCkgfHwgbWludXNLZXkuaXNEb3duKCkpIHtcclxuICAgIGNvbnN0IHJvdyA9IGNlbGwuY2xvc2VzdCgndHInKS5yb3dJbmRleCAtIDFcclxuICAgIGNvbnN0IGNvbCA9IGNlbGwuY2VsbEluZGV4XHJcbiAgICBjb25zdCBjZWxsSWR4ID0gYCR7cm93fToke2NvbH1gXHJcblxyXG4gICAgY29uc3QgdmFsdWUgPSBwYXJzZU51bWJlcihjZWxsLmlubmVyVGV4dClcclxuXHJcbiAgICBpZiAoIU51bWJlci5pc05hTih2YWx1ZSkpIHtcclxuICAgICAgaWYgKHNlbGVjdGVkQ2VsbHMuaGFzKGNlbGxJZHgpKSB7XHJcbiAgICAgICAgaWYgKHBsdXNLZXkuaXNEb3duKCkpIHtcclxuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZSgncGx1cy1iZycpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZSgnbWludXMtYmcnKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2VsZWN0ZWRDZWxscy5kZWxldGUoY2VsbElkeClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgc2lnbmVkVmFsdWVcclxuICAgICAgICBpZiAocGx1c0tleS5pc0Rvd24oKSkge1xyXG4gICAgICAgICAgc2lnbmVkVmFsdWUgPSB2YWx1ZVxyXG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdtaW51cy1iZycpXHJcbiAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ3BsdXMtYmcnKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBzaWduZWRWYWx1ZSA9IC12YWx1ZVxyXG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdwbHVzLWJnJylcclxuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnbWludXMtYmcnKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc2VsZWN0ZWRDZWxscy5zZXQoY2VsbElkeCwgc2lnbmVkVmFsdWUpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHRvdGFsID1cclxuICAgICAgICBBcnJheS5mcm9tKHNlbGVjdGVkQ2VsbHMudmFsdWVzKCkpLnJlZHVjZShcclxuICAgICAgICAgIChwcmV2LCBjdXJyKSA9PiBwcmV2ICsgY3VyciAqIDEwMCxcclxuICAgICAgICAgIDBcclxuICAgICAgICApIC8gMTAwXHJcblxyXG4gICAgICBpZiAodG90YWwgPT09IDApIHtcclxuICAgICAgICB0b3RhbEVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJ1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRvdGFsRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJ1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCB0b3RhbEZvcm1hdHRlZCA9IG5ldyBJbnRsLk51bWJlckZvcm1hdCgncHQtQlInKS5mb3JtYXQodG90YWwpXHJcbiAgICAgIHRvdGFsRWxlbWVudC5pbm5lclRleHQgPSB0b3RhbEZvcm1hdHRlZFxyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICB0b3RhbEVsZW1lbnQuaW5uZXJUZXh0ID0gJydcclxuICAgIHRvdGFsRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBwYXJzZU51bWJlcihzdHIpIHtcclxuICBjb25zdCBicmF6aWxpYW5TdHJOdW0gPSBzdHJcclxuICAgIC50cmltKClcclxuICAgIC5yZXBsYWNlKCcsJywgJ0AnKVxyXG4gICAgLnJlcGxhY2UoJy4nLCAnJylcclxuICAgIC5yZXBsYWNlKCdAJywgJy4nKVxyXG5cclxuICByZXR1cm4gTnVtYmVyKGJyYXppbGlhblN0ck51bSlcclxufVxyXG4iXX0=